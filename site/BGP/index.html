
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../ISIS/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>Scaling BGP - Notes for CCNP SPRI</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#scaling-bgp" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Notes for CCNP SPRI" class="md-header__button md-logo" aria-label="Notes for CCNP SPRI" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Notes for CCNP SPRI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Scaling BGP
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_3" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_3">
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="blue"  aria-hidden="true"  type="radio" name="__palette" id="__palette_4">
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Scaling BGP

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../ISIS/" class="md-tabs__link">
        
  
    
  
  IS-IS

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../MPLS%20LDP/" class="md-tabs__link">
        
  
    
  
  Implementing and Verifying MPLS

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../MPLS%20TE/" class="md-tabs__link">
        
  
    
  
  MPLS TE

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Multicast/" class="md-tabs__link">
        
  
    
  
  Multicast

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../OSPF/" class="md-tabs__link">
        
  
    
  
  OSPF

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Route%20Redistribution/" class="md-tabs__link">
        
  
    
  
  Route Redistribution

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Routing%20Policy/" class="md-tabs__link">
        
  
    
  
  Routing Policy and Manipulation

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../SR%20TE/" class="md-tabs__link">
        
  
    
  
  SR Traffic Engineering

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Segment%20Routing/" class="md-tabs__link">
        
  
    
  
  Segment Routing

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Notes for CCNP SPRI" class="md-nav__button md-logo" aria-label="Notes for CCNP SPRI" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Notes for CCNP SPRI
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Scaling BGP
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Scaling BGP
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#route-reflectors-and-bgp-confederation-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Route Reflectors and BGP Confederation Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scalable-ibgp-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      Scalable iBGP solutions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scalable iBGP solutions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#design-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      Design guidelines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bgp-split-horizon-rule-and-other-loop-prevention-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      BGP Split-Horizon Rule and Other Loop-prevention Mechanisms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BGP Split-Horizon Rule and Other Loop-prevention Mechanisms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modified-split-horizon-for-route-reflectors" class="md-nav__link">
    <span class="md-ellipsis">
      Modified split-horizon for Route Reflectors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bgp-loop-prevention-with-rr-cluster-id" class="md-nav__link">
    <span class="md-ellipsis">
      BGP Loop Prevention with RR-Cluster ID
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-on-bgp-rrs" class="md-nav__link">
    <span class="md-ellipsis">
      More on BGP RR's
    </span>
  </a>
  
    <nav class="md-nav" aria-label="More on BGP RR's">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hierarchical-bgp-rrs" class="md-nav__link">
    <span class="md-ellipsis">
      Hierarchical BGP RR's
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-rr" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring RR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rr-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      RR Guidelines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bgp-confederations" class="md-nav__link">
    <span class="md-ellipsis">
      BGP Confederations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ISIS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IS-IS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../MPLS%20LDP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Implementing and Verifying MPLS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../MPLS%20TE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MPLS TE
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Multicast/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multicast
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../OSPF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSPF
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Route%20Redistribution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Route Redistribution
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Routing%20Policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Routing Policy and Manipulation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SR%20TE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SR Traffic Engineering
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Segment%20Routing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Segment Routing
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="scaling-bgp">Scaling BGP</h1>
<h2 id="route-reflectors-and-bgp-confederation-overview">Route Reflectors and BGP Confederation Overview</h2>
<ul>
<li>The classic iBGP split horizon rule is that updates are received on a EBGP session should be forwarded on all iBGP and EBGP sessions, but updates that are received on an iBGP session should only be forwarded on EBGP sessions.</li>
<li>The primary reason is to avoid routing loops, and it mandates the configuration of full mesh for iBGP neighbors inside an AS -- (n<em>(n-1))/2 or 24 routers = (24</em>(24-1))/2 = 276 sessions to configure. </li>
<li>Each iBGP session is a TCP session to another iBGP peer, and updates sent to all iBGP peers could result in a significant amount of control plane TCP traffic</li>
</ul>
<h2 id="scalable-ibgp-solutions">Scalable iBGP solutions</h2>
<p>There are two solutions:</p>
<ol>
<li>Route reflectors -- these modify the split horizon rule, and they become a sort of "BGP concentrator"</li>
<li>BGP confederations -- introduce the concept of various smaller AS's within the original AS, and the smaller AS's mainain intra-confederation EBGP sessions</li>
</ol>
<h3 id="design-guidelines">Design guidelines</h3>
<ul>
<li>
<p>Route reflectors </p>
<ul>
<li>are generally preferred by operators</li>
<li><strong>Usage</strong>: when there are more than 5 iBGP-speakers, which means practically the only except are multihomed enterprise networks with 1-3 edge routers</li>
<li><strong>Primary purpose</strong>: to reduce iBGP complexity and optimize performance</li>
<li><strong>Net effect</strong>: RR modify split-horizon rule to workaround full-mesh</li>
</ul>
</li>
<li>
<p>BGP confederations</p>
<ul>
<li><strong>Usage</strong>: when a very large network consists of multiple administrative domains with differing route policies</li>
<li><strong>Primary purpose</strong>: to split a large network into smaller pieces to apply inbound and outbound policies at intra-confederation EBGP boundaries</li>
<li><strong>Net effect</strong>: BGP confederations modify iBGP AS-path processing </li>
</ul>
</li>
</ul>
<h2 id="bgp-split-horizon-rule-and-other-loop-prevention-mechanisms">BGP Split-Horizon Rule and Other Loop-prevention Mechanisms</h2>
<ul>
<li>
<p>The classic iBGP split horizon rule is that updates are received on a EBGP session should be forwarded on all iBGP and EBGP sessions, but updates that are received on an iBGP session should only be forwarded on EBGP sessions.</p>
</li>
<li>
<p>For EBGP, AS Path is checked for the presence of the local AS to prevent routes from being re-injected</p>
</li>
</ul>
<h3 id="modified-split-horizon-for-route-reflectors">Modified split-horizon for Route Reflectors</h3>
<ul>
<li>Normal EBGP processing rules, routes from EBGP sessions are forwarded to any neighbor</li>
<li>Routes from normal iBGP neighbors are sent to all iBGP clients and all EBGP peers.<ul>
<li><strong>NOTE</strong>: the default split-horizon rules apply to normal iBGP neighbors, but for iBGP clients of the RR, routes from iBGP neighbors are forwarded to iBGP clients</li>
</ul>
</li>
<li>Routes from iBGP clients are sent to any neighbor to ensure that all other routes receive updates from clients who are <em>assumed</em> to not have any other iBGP neighborships apart from with the iBGP RR</li>
</ul>
<h3 id="bgp-loop-prevention-with-rr-cluster-id">BGP Loop Prevention with RR-Cluster ID</h3>
<ul>
<li>Redundant RR can form a route reflector cluster. A BGP cluster ID (CID) is used to identify RR that form a cluster. </li>
<li>
<p>The CID is used for loop prevent-- when a route is reflected, the RR creates the BGP Cluster List attribute if it does not exist and adds or appends it's own CID to the list.</p>
<ul>
<li>If a route is received by a RR in the same cluster, it will block it similiar to AS Path loop prevention b/c the RR sees its own CID.</li>
</ul>
</li>
<li>
<p>The route reflector does not change the next-hop attribute or any common BGP attributes. </p>
</li>
<li>
<p>Additionally, when a route is reflected, the RR sets the originator-ID BGP attribute to the router ID of the peer from which it received the route. Any router that receives a route with its own router ID in the originator-ID attribute silently ignores it.</p>
</li>
<li>
<p>BGP best-path selection has some rules to include RR-related criteria. These tend to be low on the list, below preferring EBGP paths over iBGP paths</p>
<ul>
<li>When a router receives 2 iBGP paths, the nonreflected routes (with no Originator-ID) are preferred over reflected routes</li>
<li>When a comparing reflected routes that are the same, shorter cluster lists are preferred</li>
</ul>
</li>
</ul>
<h2 id="more-on-bgp-rrs">More on BGP RR's</h2>
<ul>
<li>Used to relay iBGP topology requirements</li>
<li>All of the RR configuration is only done on RR<ul>
<li>Configure which iBGP neighbors are clients</li>
<li>Configure cluster ID if redundant</li>
<li>Clients have normal iBGP neighbor config with RR</li>
<li>RR are implemented on on per address family basis </li>
</ul>
</li>
</ul>
<h3 id="hierarchical-bgp-rrs">Hierarchical BGP RR's</h3>
<p>A network designer can use hierarchies for one RR cluster to act as a client in another cluster.</p>
<p><img alt="Screenshot" src="../img/rr-hierarchy.png" /></p>
<p>Clients of top RR cluster can be RR for lower level clients
- Very useful in very large networks where one level of RR 
- Each RR has its own unique cluster ID
- Lower-level RR do not require a iBGP session between each other</p>
<h3 id="configuring-rr">Configuring RR</h3>
<div class="highlight"><span class="filename">IOS XE</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">router</span><span class="c1"># conf t</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router bgp 64497</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># bgp cluster-id 10</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># address-family ipv4 unicast</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># neighbor 203.0.133.41 router-reflector-client</span>
</code></pre></div>
<div class="highlight"><span class="filename">IOS XR</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">router</span><span class="c1"># conf t</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router bgp 64497</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">bgp</span><span class="p">)</span><span class="c1"># bgp cluster-id 10</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">bgp</span><span class="p">)</span><span class="c1"># neighbor 203.0.133.41</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">bgp</span><span class="o">-</span><span class="n">nbr</span><span class="p">)</span><span class="c1"># address-family ipv4 unitcast</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">bgp</span><span class="o">-</span><span class="n">nbr</span><span class="o">-</span><span class="n">af</span><span class="p">)</span><span class="c1"># router-reflector-client</span>
</code></pre></div>
<ul>
<li>Verifying RR neighbor status <ul>
<li>On both IOS XE/XR, in the <code>show bgp ipv4 neighbor</code> commands, there are lines indicating <code>Route-Reflector Client</code></li>
<li>When looking at BGP routes, you can see <code>Originator:</code> and <code>Cluster life:</code> fields </li>
</ul>
</li>
</ul>
<h3 id="rr-guidelines">RR Guidelines</h3>
<p>When configuring RR, you must ensure the iBGP sessions between (if hierarchical) RR are configured properly, and that RR client sessions to iBGP clients are configured properly. Clients should should not sessions with other clients.</p>
<p>Basically, do not misconfigure things. If hierarchical, you must ensure top-level RR cluster are peering with each other in iBGP full mesh. </p>
<h2 id="bgp-confederations">BGP Confederations</h2>
<p>BGP confederations can be used to split a network into smaller networks where in/outbound policies or filters be be applied on intra-confederation EBGP boundaries. </p>
<p>Commonly used to split very large networks along administrative boundaries. </p>
<ul>
<li>Each router must be aware of its real AS number to distinguish between external and intra-confederation EBGP sessions</li>
<li>
<p>Intra-confederation EBGP sessions behave almost like iBGP:</p>
<ul>
<li>Local preference, Next-hop, MED attributes are unchanged</li>
<li>Only AS path attribute is modified with internal AS numbers</li>
<li>Internal AS numbers are removed on external EBGP sessions</li>
</ul>
</li>
<li>
<p>Within the member AS or sub-AS's, iBGP rules still apply. So there must be full-mesh iBGP or RR's. </p>
</li>
</ul>
<div class="highlight"><span class="filename">IOS XE</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">router</span><span class="c1"># conf t</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router bgp 65002</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># bgp confederation identifier 64998</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">router</span><span class="p">)</span><span class="c1"># bgp confederation peers 65001 65002 65003</span>
</code></pre></div>
<ul>
<li>The real AS number is 64998, while the intra-confederation AS number is 65002 above.</li>
</ul>
<div class="highlight"><span class="filename">IOS XR</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">router</span><span class="c1"># conf t</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="c1"># router bgp 65001</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">bgp</span><span class="p">)</span><span class="c1"># bgp confederation identifier 64498</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">bgp</span><span class="p">)</span><span class="c1"># bgp confederation peers</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">bgp</span><span class="o">-</span><span class="n">confed</span><span class="o">-</span><span class="n">peers</span><span class="p">)</span><span class="c1"># 65001</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">bgp</span><span class="o">-</span><span class="n">confed</span><span class="o">-</span><span class="n">peers</span><span class="p">)</span><span class="c1"># 65002</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="n">router</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">bgp</span><span class="o">-</span><span class="n">confed</span><span class="o">-</span><span class="n">peers</span><span class="p">)</span><span class="c1"># 65003</span>
</code></pre></div>
<p>When doing <code>show bgp ipv4 unicast 204.12.13.103</code> on IOS-XE, sub-AS numbers will be in parathenthis with a note about <code>confed-external</code></p>
<p>On IOX-XR, <code>show bgp neighbor</code> will display <code>external link</code> + <code>neighbor under common admin</code>. These tell you it is an EBGP intra-confederation neighborship.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.path", "navigation.indexes", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>